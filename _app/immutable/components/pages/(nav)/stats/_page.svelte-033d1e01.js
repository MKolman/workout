import{S as K,i as M,s as O,ab as D,k as y,q as b,a as x,l as S,m as P,r as I,h as d,c as A,n as B,b as w,F as g,ac as Q,f as E,t as H,C as k,e as L,g as U,d as X,ad as R,x as V,y as j,z as G,A as J,u as N}from"../../../../chunks/index-e033f26d.js";import{C as Y,a as Z}from"../../../../chunks/ActionIcons-a9925a93.js";import{d as ee,P as te,a as oe,E as ae,f as T}from"../../../../chunks/db-e113e4cb.js";async function le(){const c=await ee.history.orderBy("time").toArray();if(c.length===0)return[];const e=[[c[0]]],n=new Set,l=new Set,o=new Set;for(const t of c.slice(1)){t.programId&&n.add(t.programId),t.workoutId&&l.add(t.workoutId),o.add(t.exerciseId);const a=e.length-1;if(e[a][0].time!==t.time){e.push([t]);continue}e[a][0].programId!==t.programId&&console.warn("program_id mismatch",e[a][0].programId,t.programId),e[a][0].workoutId!==t.workoutId&&console.warn("workout_id mismatch",e[a][0].workoutId,t.workoutId),e[a].push(t)}return await Promise.all(e.map(async t=>({time:t[0].time,program:t[0].programId?await te.get(t[0].programId):void 0,workout:t[0].workoutId?await oe.get(t[0].workoutId):void 0,exercises:await Promise.all(t.map(async a=>({sets:a.sets,exercise:await ae.get(a.exerciseId),difficulty:a.difficulty})))})))}function q(c,e,n){const l=c.slice();return l[3]=e[n],l}function W(c,e,n){const l=c.slice();return l[6]=e[n],l}function ne(c){return{c:k,l:k,m:k,p:k,i:k,o:k,d:k}}function re(c){let e,n,l=c[2],o=[];for(let t=0;t<l.length;t+=1)o[t]=F(q(c,l,t));const i=t=>H(o[t],1,1,()=>{o[t]=null});return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=L()},l(t){for(let a=0;a<o.length;a+=1)o[a].l(t);e=L()},m(t,a){for(let s=0;s<o.length;s+=1)o[s].m(t,a);w(t,e,a),n=!0},p(t,a){if(a&3){l=t[2];let s;for(s=0;s<l.length;s+=1){const f=q(t,l,s);o[s]?(o[s].p(f,a),E(o[s],1)):(o[s]=F(f),o[s].c(),E(o[s],1),o[s].m(e.parentNode,e))}for(U(),s=l.length;s<o.length;s+=1)i(s);X()}},i(t){if(!n){for(let a=0;a<l.length;a+=1)E(o[a]);n=!0}},o(t){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)H(o[a]);n=!1},d(t){R(o,t),t&&d(e)}}}function z(c){var r;let e,n,l=((r=c[6].exercise)==null?void 0:r.name)+"",o,i,t,a=T(c[6].sets)+"",s,f,p=c[6].difficulty+"",$,h,C;return{c(){e=y("span"),n=y("span"),o=b(l),i=x(),t=y("span"),s=b(a),f=b(" of "),$=b(p),h=b("kg"),C=x(),this.h()},l(u){e=S(u,"SPAN",{class:!0});var _=P(e);n=S(_,"SPAN",{class:!0});var m=P(n);o=I(m,l),m.forEach(d),i=A(_),t=S(_,"SPAN",{});var v=P(t);s=I(v,a),f=I(v," of "),$=I(v,p),h=I(v,"kg"),v.forEach(d),C=A(_),_.forEach(d),this.h()},h(){B(n,"class","name svelte-1y4xcny"),B(e,"class","row svelte-1y4xcny")},m(u,_){w(u,e,_),g(e,n),g(n,o),g(e,i),g(e,t),g(t,s),g(t,f),g(t,$),g(t,h),g(e,C)},p(u,_){var m;_&1&&l!==(l=((m=u[6].exercise)==null?void 0:m.name)+"")&&N(o,l),_&1&&a!==(a=T(u[6].sets)+"")&&N(s,a),_&1&&p!==(p=u[6].difficulty+"")&&N($,p)},d(u){u&&d(e)}}}function se(c){var C;let e,n=((C=c[3].workout)==null?void 0:C.name)+"",l,o,i,t=c[1](c[3].time)+"",a,s,f,p,$=c[3].exercises,h=[];for(let r=0;r<$.length;r+=1)h[r]=z(W(c,$,r));return{c(){e=y("h2"),l=b(n),o=x(),i=y("span"),a=b(t),s=y("br"),f=x();for(let r=0;r<h.length;r+=1)h[r].c();p=L()},l(r){e=S(r,"H2",{});var u=P(e);l=I(u,n),u.forEach(d),o=A(r),i=S(r,"SPAN",{});var _=P(i);a=I(_,t),_.forEach(d),s=S(r,"BR",{}),f=A(r);for(let m=0;m<h.length;m+=1)h[m].l(r);p=L()},m(r,u){w(r,e,u),g(e,l),w(r,o,u),w(r,i,u),g(i,a),w(r,s,u),w(r,f,u);for(let _=0;_<h.length;_+=1)h[_].m(r,u);w(r,p,u)},p(r,u){var _;if(u&1&&n!==(n=((_=r[3].workout)==null?void 0:_.name)+"")&&N(l,n),u&1&&t!==(t=r[1](r[3].time)+"")&&N(a,t),u&1){$=r[3].exercises;let m;for(m=0;m<$.length;m+=1){const v=W(r,$,m);h[m]?h[m].p(v,u):(h[m]=z(v),h[m].c(),h[m].m(p.parentNode,p))}for(;m<h.length;m+=1)h[m].d(1);h.length=$.length}},d(r){r&&d(e),r&&d(o),r&&d(i),r&&d(s),r&&d(f),R(h,r),r&&d(p)}}}function ce(c){let e,n,l;return e=new Z({props:{$$slots:{default:[se]},$$scope:{ctx:c}}}),{c(){V(e.$$.fragment),n=x()},l(o){j(e.$$.fragment,o),n=A(o)},m(o,i){G(e,o,i),w(o,n,i),l=!0},p(o,i){const t={};i&513&&(t.$$scope={dirty:i,ctx:o}),e.$set(t)},i(o){l||(E(e.$$.fragment,o),l=!0)},o(o){H(e.$$.fragment,o),l=!1},d(o){J(e,o),o&&d(n)}}}function F(c){let e,n;return e=new Y({props:{variant:"outlined",$$slots:{default:[ce]},$$scope:{ctx:c}}}),{c(){V(e.$$.fragment)},l(l){j(e.$$.fragment,l)},m(l,o){G(e,l,o),n=!0},p(l,o){const i={};o&513&&(i.$$scope={dirty:o,ctx:l}),e.$set(i)},i(l){n||(E(e.$$.fragment,l),n=!0)},o(l){H(e.$$.fragment,l),n=!1},d(l){J(e,l)}}}function ie(c){return{c:k,l:k,m:k,p:k,i:k,o:k,d:k}}function fe(c){let e,n,l,o,i,t,a={ctx:c,current:null,token:null,hasCatch:!1,pending:ie,then:re,catch:ne,value:2,blocks:[,,,]};return D(i=c[0],a),{c(){e=y("div"),n=y("h1"),l=b("History"),o=x(),a.block.c(),this.h()},l(s){e=S(s,"DIV",{class:!0});var f=P(e);n=S(f,"H1",{});var p=P(n);l=I(p,"History"),p.forEach(d),o=A(f),a.block.l(f),f.forEach(d),this.h()},h(){B(e,"class","body svelte-1y4xcny")},m(s,f){w(s,e,f),g(e,n),g(n,l),g(e,o),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,t=!0},p(s,[f]){c=s,a.ctx=c,f&1&&i!==(i=c[0])&&D(i,a)||Q(a,c,f)},i(s){t||(E(a.block),t=!0)},o(s){for(let f=0;f<3;f+=1){const p=a.blocks[f];H(p)}t=!1},d(s){s&&d(e),a.block.d(),a.token=null,a=null}}}function ue(c,e,n){let l=new Promise(i=>i([]));return l=le(),[l,i=>{const t=new Date(i);return`${t.toLocaleDateString()} ${t.toLocaleTimeString()}`}]}class pe extends K{constructor(e){super(),M(this,e,ue,fe,O,{})}}export{pe as default};
